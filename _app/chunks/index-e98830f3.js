function T(o){var e={},t,n=0,r,s,i=0,u,f="",E=String.fromCharCode,p=o.length,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0;t<64;t++)e[S.charAt(t)]=t;for(s=0;s<p;s++)for(r=e[o.charAt(s)],n=(n<<6)+r,i+=6;i>=8;)((u=n>>>(i-=8)&255)||s<p-2)&&(f+=E(u));return f}function _(o){const t=o.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=T(t);return JSON.parse(n)}const{VITE_API_URL:I=""}={VITE_API_URL:"https://si21.herokuapp.com",VITE_SVELTEKIT_AMP:"",BASE_URL:"/_app/",MODE:"production",DEV:!1,PROD:!0};let c;const a={};function w(o){if(o in a)return a[o].forEach(e=>e());try{const{type:e,data:t}=JSON.parse(o);if(e in a)return a[e].forEach(n=>n(t));console.groupCollapsed("ws:received "+e),console.log(t),console.groupEnd()}catch(e){console.error(e)}}let g;function l(){if(!("WebSocket"in globalThis))return;let o=I||window.location.host,e=new WebSocket("ws://"+o.replace("https://","").replace("http://",""));e.onmessage=n=>{w(n.data)};let t;return g=new Promise(n=>{t=n}),e.onopen=()=>{console.log("Websocket Connected"),setTimeout(()=>{t()},50),t()},e.onclose=()=>{setTimeout(async()=>{console.log("Reconnecting"),c=l()},500)},e}function O(o,e){return c||(c=l()),a[o]=o in a?[...a[o],e]:[e],()=>{a[o]=a[o].filter(t=>t!==e)}}async function A(o,e){c||(c=l()),await g,c.send(JSON.stringify({type:o,data:e}))}const{VITE_API_URL:h=""}={VITE_API_URL:"https://si21.herokuapp.com",VITE_SVELTEKIT_AMP:"",BASE_URL:"/_app/",MODE:"production",DEV:!1,PROD:!0};async function d(o,{method:e,body:t,token:n}){const r={method:e};t&&(r.body=JSON.stringify(t)),"localStorage"in globalThis&&"jwt"in localStorage&&(r.headers={Authentication:`Bearer ${n||localStorage.getItem("jwt")}`}),e==="POST"&&t&&("headers"in r||(r.headers={}),r.headers["Content-Type"]="application/json");const s=(h?h+"/":"/")+o;return fetch(s,r)}function V(o,e){return d(o,{method:"GET",token:e})}if("jwt"in localStorage){const{jwt:o}=localStorage,{role:e}=_(o);console.log("DECODE",e),e==="ADMIN"&&A("admin",o)}function P(o,e,t){return d(o,{method:"POST",body:e,token:t})}async function m(o,e){const t=await P("api/auth/login",{username:o,password:e});if(!t.ok)return!1;const{token:n}=await t.json();return n?(localStorage.setItem("jwt",n),!0):!1}export{_ as d,A as e,V as g,m as l,O as o,P as p};
