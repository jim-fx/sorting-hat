function T(o){var e={},t,n=0,r,a,i=0,u,f="",E=String.fromCharCode,p=o.length,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0;t<64;t++)e[S.charAt(t)]=t;for(a=0;a<p;a++)for(r=e[o.charAt(a)],n=(n<<6)+r,i+=6;i>=8;)((u=n>>>(i-=8)&255)||a<p-2)&&(f+=E(u));return f}function _(o){const t=o.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=T(t);return JSON.parse(n)}const{VITE_API_URL:w=""}={VITE_API_URL:"https://si21.herokuapp.com",VITE_SVELTEKIT_AMP:"",BASE_URL:"/_app/",MODE:"production",DEV:!1,PROD:!0};let c;const s={};function I(o){if(o in s)return s[o].forEach(e=>e());try{const{type:e,data:t}=JSON.parse(o);if(e in s)return s[e].forEach(n=>n(t));console.groupCollapsed("ws:received "+e),console.log(t),console.groupEnd()}catch(e){console.error(e)}}let d;function l(){if(!("WebSocket"in globalThis))return;let o=w||window.location.host;const e=window.location.protocol.includes("s");let t=new WebSocket(`ws${e?"s":""}://`+o.replace("https://","").replace("http://",""));t.onmessage=r=>{I(r.data)};let n;return d=new Promise(r=>{n=r}),t.onopen=()=>{console.log("Websocket Connected"),setTimeout(()=>{n()},50),n()},t.onclose=()=>{setTimeout(async()=>{console.log("Reconnecting"),c=l()},500)},t}function O(o,e){return c||(c=l()),s[o]=o in s?[...s[o],e]:[e],()=>{s[o]=s[o].filter(t=>t!==e)}}async function A(o,e){c||(c=l()),await d,c.send(JSON.stringify({type:o,data:e}))}const{VITE_API_URL:g=""}={VITE_API_URL:"https://si21.herokuapp.com",VITE_SVELTEKIT_AMP:"",BASE_URL:"/_app/",MODE:"production",DEV:!1,PROD:!0};async function h(o,{method:e,body:t,token:n}){const r={method:e};t&&(r.body=JSON.stringify(t)),"localStorage"in globalThis&&"jwt"in localStorage&&(r.headers={Authentication:`Bearer ${n||localStorage.getItem("jwt")}`}),e==="POST"&&t&&("headers"in r||(r.headers={}),r.headers["Content-Type"]="application/json");const a=(g?g+"/":"/")+o;return fetch(a,r)}function V(o,e){return h(o,{method:"GET",token:e})}if("jwt"in localStorage){const{jwt:o}=localStorage,{role:e}=_(o);console.log("DECODE",e),e==="ADMIN"&&A("admin",o)}function P(o,e,t){return h(o,{method:"POST",body:e,token:t})}async function m(o,e){const t=await P("api/auth/login",{username:o,password:e});if(!t.ok)return!1;const{token:n}=await t.json();return n?(localStorage.setItem("jwt",n),!0):!1}export{_ as d,A as e,V as g,m as l,O as o,P as p};
