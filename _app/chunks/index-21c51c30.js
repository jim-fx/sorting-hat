function I(e){var o={},n,t=0,r,i,c=0,p,d="",w=String.fromCharCode,h=e.length,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(n=0;n<64;n++)o[A.charAt(n)]=n;for(i=0;i<h;i++)for(r=o[e.charAt(i)],t=(t<<6)+r,c+=6;c>=8;)((p=t>>>(c-=8)&255)||i<h-2)&&(d+=w(p));return d}function O(e){if(!e)return{};const o=e.split(".")[1],n=o==null?void 0:o.replace(/-/g,"+").replace(/_/g,"/");if(!n)return{};const t=I(n);return JSON.parse(t)}function m(e){return e[0].toUpperCase()+e.slice(1)}function l(e){return e&&typeof e=="object"&&!Array.isArray(e)}function g(e,...o){if(!o.length)return e;const n=o.shift();if(l(e)&&l(n))for(const t in n)l(n[t])?(e[t]||Object.assign(e,{[t]:{}}),g(e[t],n[t])):Object.assign(e,{[t]:n[t]});return g(e,...o)}const{VITE_API_URL:P=""}={VITE_API_URL:"https://si21.herokuapp.com",VITE_SVELTEKIT_AMP:"",BASE_URL:"/_app/",MODE:"production",DEV:!1,PROD:!0};let a;const s={};function y(e){if(e in s)return s[e].forEach(o=>o());try{const{type:o,data:n}=JSON.parse(e);if(console.groupCollapsed("ws:received "+o,o in s),console.log(n),console.log(s),console.groupEnd(),o in s)return s[o].forEach(t=>t(n))}catch(o){console.error(o)}}let E;function u(){if(!("WebSocket"in globalThis))return;let e=P||window.location.host;const o=window.location.protocol.includes("s");let n=new WebSocket(`ws${o?"s":""}://`+e.replace("https://","").replace("http://",""));n.onmessage=r=>{y(r.data)};let t;return E=new Promise(r=>{t=r}),n.onopen=()=>{console.log("Websocket Connected"),t(),setTimeout(()=>{"open"in s&&s.open.forEach(r=>r(n))},50),t()},n.onclose=()=>{setTimeout(async()=>{console.log("Reconnecting"),a=u()},500)},n}function L(e,o){return a||(a=u()),s[e]=e in s?[...s[e],o]:[o],()=>{s[e]=s[e].filter(n=>n!==o)}}async function V(e,o){a||(a=u()),await E,a.send(JSON.stringify({type:e,data:o}))}const{VITE_API_URL:S=""}={VITE_API_URL:"https://si21.herokuapp.com",VITE_SVELTEKIT_AMP:"",BASE_URL:"/_app/",MODE:"production",DEV:!1,PROD:!0};async function T(e,{method:o,body:n,token:t}){const r={method:o};n&&(r.body=JSON.stringify(n));let i="localStorage"in globalThis?localStorage.getItem("jwt"):"";t&&(i=t),i&&(r.headers={Authentication:`Bearer ${t||i}`}),o==="POST"&&n&&("headers"in r||(r.headers={}),r.headers["Content-Type"]="application/json");const c=(S?S+"/":"/")+e;return console.groupCollapsed("send."+o.toLowerCase(),c),console.log({body:n,token:t,headers:r.headers}),console.groupEnd(),fetch(c,r)}function R(e,o){return T(e,{method:"GET",token:o})}let f;function _(){if("jwt"in localStorage&&f){const{jwt:e}=localStorage,{role:o}=O(e);o==="ADMIN"&&(f.update(n=>(n.role=o,n)),V("admin",e))}}L("open",()=>{_()});function k(e){f=e,_()}function j(e,o,n){return T(e,{method:"POST",body:o,token:n})}async function C(e,o){const n=await j("api/auth/login",{username:e,password:o});if(!n.ok)return!1;const{token:t}=await n.json();return t?(localStorage.setItem("jwt",t),!0):!1}export{m as c,O as d,V as e,R as g,C as l,g as m,L as o,j as p,k as s};
